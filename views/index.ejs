<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= settings.title %></title>
    <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%2310b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>'>
    <link href="/style.css" rel="stylesheet">
</head>
<body class="text-slate-300 min-h-screen flex flex-col">

    <div class="relative hero-bg pt-12 pb-16 px-6 transition-colors duration-300">
        
        <div class="absolute top-6 right-6 flex gap-2">
            <button onclick="toggleLayout()" class="theme-toggle p-2 rounded-full glass transition-all" aria-label="Toggle Layout" title="Switch View">
                <svg id="icon-grid" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                <svg id="icon-list" class="w-5 h-5 block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            
            <button onclick="toggleTheme()" class="theme-toggle p-2 rounded-full glass transition-all" aria-label="Toggle Theme" title="Switch Theme">
                <svg id="icon-sun" class="w-5 h-5 block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="icon-moon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </div>

        <div class="max-w-5xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                <div class="flex items-center gap-4">
                    <% if (settings.logo_url) { %>
                        <img src="<%= settings.logo_url %>" alt="Logo" class="w-12 h-12 object-contain rounded-lg">
                    <% } %>
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight mb-2"><%= settings.title %></h1>
                        <p class="text-slate-400">Live service health & uptime monitoring</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-3 px-5 py-3 rounded-full glass border border-white/10 shadow-xl transition-all duration-300">
                    <% if (stats.status === 'operational') { %>
                        <span class="relative flex h-4 w-4">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-4 w-4 bg-emerald-500 glow-green"></span>
                        </span>
                        <div class="flex flex-col">
                            <span class="text-sm font-bold text-white leading-none">All Systems Operational</span>
                            <span class="text-[10px] text-emerald-400 font-mono mt-1">100% UPTIME TODAY</span>
                        </div>
                    <% } else if (stats.status === 'degraded') { %>
                        <span class="relative inline-flex rounded-full h-4 w-4 bg-yellow-500 glow-yellow animate-pulse"></span>
                        <div class="flex flex-col">
                            <span class="text-sm font-bold text-white leading-none">Partial Degradation</span>
                            <span class="text-[10px] text-yellow-400 font-mono mt-1">SOME SERVICES DOWN</span>
                        </div>
                    <% } else { %>
                        <span class="relative inline-flex rounded-full h-4 w-4 bg-red-500 glow-red animate-pulse"></span>
                        <div class="flex flex-col">
                            <span class="text-sm font-bold text-white leading-none">Major Outage</span>
                            <span class="text-[10px] text-red-400 font-mono mt-1">CRITICAL FAILURES</span>
                        </div>
                    <% } %>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-10">
                <div class="glass rounded-xl p-4 flex flex-col transition-all duration-300">
                    <span class="text-xs font-bold uppercase text-slate-500 tracking-wider">Monitors</span>
                    <span class="text-2xl font-bold text-white mt-1"><%= stats.active %></span>
                </div>
                <div class="glass rounded-xl p-4 flex flex-col transition-all duration-300">
                    <span class="text-xs font-bold uppercase text-slate-500 tracking-wider">Services Up</span>
                    <span class="text-2xl font-bold text-emerald-400 mt-1"><%= stats.online %></span>
                </div>
                <div class="glass rounded-xl p-4 flex flex-col transition-all duration-300">
                    <span class="text-xs font-bold uppercase text-slate-500 tracking-wider">Avg Latency</span>
                    <span class="text-2xl font-bold text-blue-400 mt-1"><%= stats.avgLatency %> <span class="text-sm text-slate-500">ms</span></span>
                </div>
                <div class="glass rounded-xl p-4 flex flex-col transition-all duration-300">
                    <span class="text-xs font-bold uppercase text-slate-500 tracking-wider">Next Update</span>
                    <span class="text-2xl font-bold text-slate-300 mt-1" id="timer">60s</span>
                </div>
            </div>
        </div>
    </div>

    <main class="flex-grow max-w-5xl mx-auto px-6 -mt-8 w-full z-10 pb-12">
        <div id="monitor-container" class="grid grid-cols-1 gap-4 transition-all duration-500">
            
            <% monitors.forEach(m => { %>
                <div class="glass-card rounded-xl p-5 md:p-6 transition-all duration-300 hover:border-slate-600/50 group relative overflow-hidden h-full">
                    
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br <%= m.status === 'up' ? 'from-emerald-500/5' : 'from-red-500/5' %> to-transparent rounded-bl-full pointer-events-none"></div>

                    <div class="card-header-flex flex flex-wrap justify-between gap-4 mb-6">
                        
                        <div class="flex items-center gap-4 z-10 min-w-0 flex-1">
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0 <%= m.status === 'up' ? 'bg-emerald-500/10 border border-emerald-500/20' : 'bg-red-500/10 border border-red-500/20' %>">
                                <% if (m.status === 'up') { %>
                                    <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                <% } else { %>
                                    <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                <% } %>
                            </div>
                            <div class="min-w-0 flex-grow">
                                <h3 class="text-lg font-bold text-white flex items-center gap-2 truncate">
                                    <%= m.name %>
                                    <% if (m.uptime === 100) { %>
                                        <span class="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-800 text-slate-400 border border-slate-700 shrink-0">100%</span>
                                    <% } else { %>
                                        <span class="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-800 text-yellow-500 border border-slate-700 shrink-0"><%= m.uptime %>%</span>
                                    <% } %>
                                </h3>
                                <a href="<%= m.url %>" target="_blank" class="block text-sm text-slate-500 hover:text-blue-400 transition-colors font-mono truncate"><%= m.url %></a>
                            </div>
                        </div>

                        <div class="card-header-right flex items-center gap-4 z-10 flex-shrink-0 ml-auto">
                            
                            <div class="hidden sm:block w-24 h-10 opacity-40 shrink-0">
                                <% 
                                    const h = m.history;
                                    const maxLat = Math.max(...h.map(x => x.latency), 100); 
                                    let points = "";
                                    h.forEach((pt, i) => {
                                        const x = (i / (h.length - 1 || 1)) * 100;
                                        const y = 40 - ((pt.latency / maxLat) * 40);
                                        points += `${x},${y} `;
                                    });
                                %>
                                <svg width="100%" height="100%" viewBox="0 0 100 40" preserveAspectRatio="none" class="overflow-visible">
                                    <path d="M0,40 <%= points %> 100,40 Z" fill="url(#grad<%= m.id %>)" />
                                    <polyline points="<%= points %>" fill="none" stroke="<%= m.status === 'up' ? '#10b981' : '#ef4444' %>" stroke-width="2" stroke-linejoin="round" />
                                    <defs>
                                        <linearGradient id="grad<%= m.id %>" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="0%" stop-color="<%= m.status === 'up' ? '#10b981' : '#ef4444' %>" stop-opacity="0.3"/>
                                            <stop offset="100%" stop-color="<%= m.status === 'up' ? '#10b981' : '#ef4444' %>" stop-opacity="0"/>
                                        </linearGradient>
                                    </defs>
                                </svg>
                            </div>

                            <div class="text-right">
                                <div class="text-xl font-bold font-mono text-white tracking-tighter stat-transition" id="latency-val-<%= m.id %>">
                                    <%= m.response_time %>ms
                                </div>
                                <div class="text-[10px] text-slate-500 uppercase font-bold tracking-wider stat-transition" id="latency-label-<%= m.id %>">
                                    Current Latency
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="relative mt-2" onmouseleave="resetStats(<%= m.id %>, '<%= m.response_time %>')">
                        <div class="flex items-end gap-[3px] h-10 w-full">
                            <% m.history.forEach(h => { %>
                                <div class="flex-1 min-w-[4px] rounded-sm transition-all hover:opacity-100 hover:scale-y-110 hover:bg-white origin-bottom cursor-pointer
                                    <%= h.status === 'up' ? (h.latency > 500 ? 'bg-yellow-500 opacity-60' : 'bg-emerald-500 opacity-40') : 'bg-red-500 opacity-80' %>"
                                    style="height: <%= h.status === 'down' ? '100%' : Math.max(20, Math.min(100, (h.latency / 2))) + '%' %>;"
                                    onmouseenter="updateStats(<%= m.id %>, '<%= h.latency %>', '<%= new Date(h.timestamp).toLocaleTimeString() %>', '<%= h.status %>')">
                                </div>
                            <% }) %>
                            
                            <% for(let i=0; i < (50 - m.history.length); i++) { %>
                                <div class="flex-1 h-1 bg-slate-800 rounded-sm"></div>
                            <% } %>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>
    </main>

    <footer class="max-w-5xl mx-auto px-6 mb-12 w-full">
        <div class="border-t border-slate-800/50 pt-12">

            <div class="flex flex-col items-center text-center gap-8 mb-10">

                <div class="flex flex-col items-center gap-2">
                    <div class="flex items-center gap-3 mb-2">
                        <% if (settings.logo_url) { %>
                            <img src="<%= settings.logo_url %>" alt="Logo" class="w-8 h-8 object-contain rounded-md grayscale opacity-80 hover:grayscale-0 hover:opacity-100 transition-all">
                        <% } %>
                        <h3 class="font-bold text-white tracking-tight text-lg"><%= settings.title %></h3>
                    </div>
                    <p class="text-xs text-slate-500 leading-relaxed font-medium">
                        <%= settings.footer_text %> &nbsp;&bull;&nbsp; &copy; <span id="year"></span>
                    </p>
                </div>

                <% if (settings.footer_info) { %>
                    <p class="text-sm text-slate-400 leading-relaxed whitespace-pre-wrap max-w-lg mx-auto opacity-80">
                        <%= settings.footer_info %>
                    </p>
                <% } %>

                <% if (settings.footer_links && settings.footer_links.length > 0) { %>
                    <div class="flex flex-wrap justify-center gap-6">
                        <% settings.footer_links.forEach(link => { %>
                            <a href="<%= link.url %>" target="_blank" class="text-sm text-slate-500 hover:text-blue-400 transition-colors font-medium flex items-center gap-1.5 group">
                                <%= link.label %>
                                <svg class="w-3 h-3 opacity-0 -ml-2 translate-x-[-2px] group-hover:opacity-100 group-hover:translate-x-0 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                            </a>
                        <% }) %>
                    </div>
                <% } %>
            </div>

            <% if (settings.show_footer_stats) { %>
                <div class="glass stats-bar-bg rounded-2xl px-8 py-5 flex flex-wrap justify-center md:justify-between items-center gap-6 md:gap-12 transition-colors duration-300 max-w-4xl mx-auto shadow-lg">
                    
                    <div class="flex items-center gap-4">
                        <div class="p-2.5 rounded-full stats-icon-bg text-slate-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        </div>
                        <div class="text-left">
                            <div class="stats-label text-[10px] md:text-xs">Active Monitors</div>
                            <div class="stats-value text-base md:text-lg"><%= stats.active %></div>
                        </div>
                    </div>

                    <div class="stats-divider h-10 w-px"></div>

                    <div class="flex items-center gap-4">
                        <div class="p-2.5 rounded-full stats-icon-bg text-emerald-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <div class="text-left">
                            <div class="stats-label text-[10px] md:text-xs">Services Online</div>
                            <div class="stats-value text-base md:text-lg"><%= stats.online %> / <%= stats.active %></div>
                        </div>
                    </div>

                    <div class="stats-divider h-10 w-px"></div>

                    <div class="flex items-center gap-4">
                        <div class="p-2.5 rounded-full stats-icon-bg text-blue-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        </div>
                        <div class="text-left">
                            <div class="stats-label text-[10px] md:text-xs">Avg Latency</div>
                            <div class="stats-value text-base md:text-lg"><%= stats.avgLatency %>ms</div>
                        </div>
                    </div>
                </div>
            <% } %>

        </div>
    </footer>

    <script>
        document.getElementById("year").innerText = new Date().getFullYear();

        // --- LAYOUT LOGIC ---
        const container = document.getElementById('monitor-container');
        const iconList = document.getElementById('icon-list');
        const iconGrid = document.getElementById('icon-grid');

        function toggleLayout() {
            container.classList.toggle('md:grid-cols-2');
            const isGrid = container.classList.contains('md:grid-cols-2');

            if (isGrid) {
                iconList.classList.add('hidden');
                iconGrid.classList.remove('hidden');
                localStorage.setItem('layout', 'grid');
                container.classList.add('layout-grid'); // ADDED CLASS FOR CSS
            } else {
                iconList.classList.remove('hidden');
                iconGrid.classList.add('hidden');
                localStorage.setItem('layout', 'list');
                container.classList.remove('layout-grid'); // REMOVE CLASS
            }
        }

        if (localStorage.getItem('layout') === 'grid') {
            container.classList.add('md:grid-cols-2');
            container.classList.add('layout-grid'); // RESTORE CLASS
            iconList.classList.add('hidden');
            iconGrid.classList.remove('hidden');
        }

        // --- THEME LOGIC ---
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            if (isLight) {
                document.getElementById('icon-sun').classList.add('hidden');
                document.getElementById('icon-moon').classList.remove('hidden');
                localStorage.setItem('theme', 'light');
            } else {
                document.getElementById('icon-sun').classList.remove('hidden');
                document.getElementById('icon-moon').classList.add('hidden');
                localStorage.setItem('theme', 'dark');
            }
        }
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-mode');
            document.getElementById('icon-sun').classList.add('hidden');
            document.getElementById('icon-moon').classList.remove('hidden');
        }

        // --- STATS LOGIC ---
        function updateStats(id, latency, time, status) {
            const valEl = document.getElementById(`latency-val-${id}`);
            const labelEl = document.getElementById(`latency-label-${id}`);
            valEl.innerText = latency + 'ms';
            valEl.style.color = status === 'up' ? (document.body.classList.contains('light-mode') ? '#059669' : '#fff') : '#ef4444'; 
            labelEl.innerText = time;
            labelEl.style.color = '#3b82f6';
        }

        function resetStats(id, currentLatency) {
            const valEl = document.getElementById(`latency-val-${id}`);
            const labelEl = document.getElementById(`latency-label-${id}`);
            valEl.innerText = currentLatency + 'ms';
            valEl.style.color = ''; 
            labelEl.innerText = 'CURRENT LATENCY';
            labelEl.style.color = ''; 
        }

        let timeLeft = 60;
        const timerEl = document.getElementById('timer');
        setInterval(() => {
            timeLeft--;
            if (timeLeft <= 0) { timeLeft = 0; window.location.reload(); }
            timerEl.innerText = timeLeft + 's';
        }, 1000);
    </script>
</body>
</html>
